(function(e){function P(e,t){return t.indexOf(e)>-1}function H(e,t){for(var n in e){if(e[n]==t){e.splice(n,1);break}}}var t="file";var n=e("#ap_container");var r=e("#ap_content");var s=e(".range_origin");var o=e(".range_origin_space");var u=e(".range_start");var a=e(".range_end");var f=e(".paging_controls");var l=[["http://api.adoptapet.com/search/pets_at_shelter?key=95052e1b892a28c5f89f696edf39b4ec&shelter_id=87677&output=json"],["http://api.adoptapet.com/search/pets_at_shelter?key=ffa2f34adb6076ce7aba8162fb899d64&shelter_id=87678&output=json"]];var c=0;var h=0;var p=0;var d=[];var v=[];var m=[];var g=0;var y=0;var b=12;var w=0;var E=[];E.location=[];E.species=[];E.sex=[];E.age=[];E.color=[];E.breed=[];var S=[];S.location=[];S.species=[];S.sex=[];S.age=[];S.color=[];S.breed=[];var x=function(){n.attr("class","");if(t="file"){url=""+window.location.href.split(window.location.pathname)[0]+"/showDetail/data/data.txt";e.ajax({type:"post",url:"/showDetail/getData.php",data:{data_url:url}}).done(function(e,t,n){d=JSON.parse(e);C()}).fail(function(e,t,n){console.log("failed")})}else{if(l.length>0){for(var r=0;r<l.length;r++){T(l[r][0])}}else{}}};var T=function(t){e.ajax({type:"post",url:"/showDetail/getData.php",data:{data_url:t}}).done(function(e,t,n){N(e)}).fail(function(e,t,n){})};var N=function(t){t=JSON.parse(t);h=h+t.returned_pets;if(t.pets){for(var n=0;n<t.pets.length;n++){url=t.pets[n].details_url;preview_image=[t.pets[n].results_photo_url,t.pets[n].results_photo_width,t.pets[n].results_photo_height];(function(t,n){t=t.replace("limited_","");e.ajax({type:"post",url:"/showDetail/getData.php",data:{data_url:t}}).done(function(e,r,i){e=JSON.parse(e);e.pet.pet_name=e.pet.pet_name.split(" ")[0];e.pet.pet_name=e.pet.pet_name.split("-")[0];e.pet.pet_name=e.pet.pet_name.split(".")[0];e.pet.pet_name=e.pet.pet_name.split(",")[0];e.pet.preview_image=n;e.pet.details_url=t;e.pet.color_array=e.pet.color.toLowerCase();e.pet.color_array=B(e.pet.color_array);e.pet.location=[e.pet.addr_city];d.push(e.pet);p=p+1;if(p==h){k()}}).fail(function(e,t,n){})})(url,preview_image)}}else{}};var C=function(){for(var e in d){if(d.hasOwnProperty(e)){d[e].color_array=d[e].color.toLowerCase();d[e].color_array=B(d[e].color_array)}}k()};var k=function(){for(var e in d){if(d.hasOwnProperty(e)){color=d[e].color_array;for(var t=0;t<color.length;t++){E.color.push(color[t].toLowerCase())}E.breed.push(d[e].primary_breed);E.location.push(d[e].addr_city);E.species.push(d[e].species);E.sex.push(d[e].sex);E.age.push(d[e].age)}}E.location=_.uniq(E.location,false);E.species=_.uniq(E.species,false);E.sex=_.uniq(E.sex,false);E.age=_.uniq(E.age,false);E.color=_.uniq(E.color,false);E.breed=_.uniq(E.breed,false);E.location=E.location.sort(function(e,t){if(e<t)return 1;if(t<e)return-1;return 0}).reverse();E.species=E.species.sort(function(e,t){if(e<t)return 1;if(t<e)return-1;return 0}).reverse();E.sex=E.sex.sort(function(e,t){if(e<t)return 1;if(t<e)return-1;return 0}).reverse();age=[];for(age_i=0;age_i<E.age.length;age_i++){if(E.age[age_i]=="Senior"){age[0]=E.age[age_i]}else if(E.age[age_i]=="Adult"){age[1]=E.age[age_i]}else if(E.age[age_i]=="Young"){age[2]=E.age[age_i]}else if(E.age[age_i]=="Kitten"){age[3]=E.age[age_i]}else if(E.age[age_i]=="Puppy"){age[4]=E.age[age_i]}}age=age.filter(function(e){return e});E.age=age;E.color=E.color.sort(function(e,t){if(e<t)return 1;if(t<e)return-1;return 0}).reverse();E.breed=E.breed.sort(function(e,t){if(e<t)return 1;if(t<e)return-1;return 0}).reverse();L()};var L=function(){for(var t in E){if(E.hasOwnProperty(t)){defaultOpen="";dataFilterOpen="false";if(t=="location"){defaultOpen="open";dataFilterOpen="true"}e(".controls").append('<ul class="filter_'+t+" "+defaultOpen+'" data-filter-group="'+t+'"></ul>');e(".filter_"+t+"").append('<lh class="filter_header_'+t+'" data-filter-parent="'+t+'" data-filter-open="'+dataFilterOpen+'">'+t+"</lh>");e(".filter_header_"+t+"").click(function(){if(e(this).attr("data-filter-open")=="false"){parent_filter=e(this).attr("data-filter-parent");e(this).attr("data-filter-open","true");e(".filter_"+parent_filter+"").addClass("open")}else{parent_filter=e(this).attr("data-filter-parent");e(this).attr("data-filter-open","false");e(".filter_"+parent_filter+"").removeClass("open")}});for(var r=0;r<E[t].length;r++){cssName=""+[t]+"_"+[r]+"";e(".filter_"+t+"").append('<li class="'+cssName+'" data-filter="'+E[t][r]+'" data-filter-parent="'+t+'" data-filter-applied="false">'+E[t][r]+" <span>x</span></li>");e("."+cssName+"").click(function(){parent_filter=e(this).attr("data-filter-parent");filter=e(this).attr("data-filter");if(e(this).attr("data-filter-applied")=="true"){H(S[parent_filter],filter);S[parent_filter]=_.uniq(S[parent_filter],false);e(this).removeClass("active");e(this).attr("data-filter-applied","false")}else{S[parent_filter].push(filter);S[parent_filter]=_.uniq(S[parent_filter],false);e(this).addClass("active");e(this).attr("data-filter-applied","true")}n.attr("class","");A()})}}}A()};var A=function(){n.attr("class","");r.html("");v=[];g=0;if(S.location.length>0){g=g+1}if(S.color.length>0){g=g+1}if(S.species.length>0){g=g+1}if(S.sex.length>0){g=g+1}if(S.age.length>0){g=g+1}if(S.breed.length>0){g=g+1}for(var e=0;e<d.length;e++){_filter_count=0;for(var t=0;t<d[e].location.length;t++){if(P(d[e].location[t],S.location)){_filter_count=_filter_count+1}}for(var i=0;i<d[e].color_array.length;i++){if(P(d[e].color_array[i],S.color)){_filter_count=_filter_count+1}}for(var s=0;s<S.species.length;s++){if(d[e].species==S.species[s]){_filter_count=_filter_count+1}}for(var o=0;o<S.sex.length;o++){if(d[e].sex==S.sex[o]){_filter_count=_filter_count+1}}for(var u=0;u<S.age.length;u++){if(d[e].age==S.age[u]){_filter_count=_filter_count+1}}for(var a=0;a<S.breed.length;a++){if(d[e].primary_breed==S.breed[a]){_filter_count=_filter_count+1}}if(_filter_count===g){v.push(d[e])}}v=_.uniq(v,false);M();O()};var O=function(){isActive=0;activeArray="";e(".active-filters").html("");checkFilters=0;if(S){for(var t in S){if(S.hasOwnProperty(t)){if(S[t].length>0){checkFilters=1}}}}if(checkFilters==1){for(var t in S){if(S.hasOwnProperty(t)){if(S[t].length>0){isActive=1;activeArray=activeArray+"&"+[t]+"="+JSON.stringify(S[t])+"";for(i=0;i<S[t].length;i++){cssName=""+[t]+"_"+[i]+"";e(".active-filters").append('<div class="active_filter_'+cssName+'" active-data-filter="'+S[t][i]+'" data-filter-parent="'+S[t]+'">'+S[t][i]+" <span>x</span></div>");e(".active_filter_"+cssName+"").click(function(){parent_filter=e(this).attr("data-filter-parent");filter=e(this).attr("active-data-filter");e('*[data-filter="'+filter+'"]').click()})}}}}e(".active-filters").append('<div class="active_filter_all" active-data-filter="all" data-filter-parent="all">Clear Filters</div>');e(".active_filter_all").click(function(){e('[data-filter-applied="true"]').each(function(){e(this).click()})})}if(isActive==1){activeArray="AdoptablePets=true"+activeArray;e(".filter-key").addClass("active")}else{activeArray="";e(".filter-key").removeClass("active")}};e("#view_count").change(function(){M()});var M=function(){y=0;total_count=v.length;b=e("#view_count").val();if(b==="all"){b=total_count}w=total_count/b;w=Math.floor(parseFloat(w,10));pages_remainder=total_count-w*b;if(pages_remainder>0){w=w+1}v=v.sort(function(e,t){if(e.pet_name<t.pet_name)return 1;if(t.pet_name<e.pet_name)return-1;return 0}).reverse();f.html("");for(i=0;i<w;i++){i_offset=i+1;if(i!=0){f.append('<div class="view-offset-'+i+'" data-offset="'+i+'">'+i_offset+"</div>")}else{f.append('<div class="view-offset-'+i+' active" data-offset="'+i+'">'+i_offset+"</div>")}e(".view-offset-"+i+"").click(function(t){t.preventDefault();e(".paging_controls div").each(function(){e(this).removeClass("active")});e(this).addClass("active");y=parseInt(e(this).attr("data-offset"));b=parseInt(e("#view_count").val());y=y*b;_view_offset=y+b;m=v.slice(y,_view_offset);D()})}if(w==0){f.append('<div class="view-offset-0 active" data-offset="0">1</div>')}m=v.slice(y,b);D()};var D=function(){r.html("");s.show();o.show();if(m.length){total_count=v.length;_total_count=y;if(_total_count==0){_total_count=b}else{_total_count=y+b}total_count_origin=_total_count-b+1;if(_total_count>total_count||_total_count==total_count){_total_count=v.length}if(_total_count==total_count&&total_count==total_count_origin){s.hide();o.hide()}else if(w==0||w==1){s.hide();o.hide()}else if(e("#view_count").val()=="all"){s.hide();o.hide()}for(var t=0;t<m.length;t++){pet=m[t].pet_id;pet_id="pet_id_"+m[t].pet_id+"";pet_url=m[t].details_url;pet_location=m[t].addr_city;pet_name=m[t].pet_name;pet_age=m[t].age;pet_sex=m[t].sex;if(m[t].images.length==0){pet_photo="/img/no-dog.gif";pet_photo_w="";pet_photo_h=""}else{pet_photo=m[t].images[0]["original_url"];pet_photo_w=""+m[t].images[0]["original_width"]+"px";pet_photo_h=""+m[t].images[0]["original_height"]+"px"}cellFormat='<a href="/adoptable-pet-detail?'+pet+'" class="pet" id="'+pet_id+'" data-pet-url="'+pet_url+'"><div class="photo_wrapper"><img class="pet_photo" src="'+pet_photo+'" style="width: '+pet_photo_w+"; height: "+pet_photo_h+';" /></div> <div class="pet_name">'+pet_name+'</div> <div class="pet_info">'+pet_sex+", <span>"+pet_age+'</span></div> <div class="pet_city">'+pet_location+"</div> </a>";r.append(cellFormat)}s.html(total_count_origin);u.html(_total_count);a.html(total_count);n.addClass("ready")}else{u.html("0");a.html(total_count);r.append("there is no data");n.addClass("ready")}};var B=function(e){switch(e){case"black":color=["black"];return color;break;case"black - with brown, red, golden, orange or chestnut":color=["black","brown","red","golden","orange","chestnut"];return color;break;case"black - with gray or silver":color=["black","gray","silver"];return color;break;case"black - with tan, yellow or fawn":color=["black","tan","yellow","fawn"];return color;break;case"black - with white":color=["black","white"];return color;break;case"brindle":color=["brindle"];return color;break;case"brindle - with white":color=["brindle","white"];return color;break;case"brown/chocolate":color=["brown","chocolate"];return color;break;case"brown/chocolate - with black":color=["brown","chocolate","black"];return color;break;case"brown/chocolate - with tan":color=["brown","chocolate","tan"];return color;break;case"brown/chocolate - with white":color=["brown","chocolate","white"];return color;break;case"gray/blue/silver/salt & pepper":color=["gray","blue","silver","salt pepper"];return color;break;case"gray/silver/salt & pepper - with white":color=["gray","silver","salt pepper","white"];return color;break;case"merle":color=["merle"];return color;break;case"red/golden/orange/chestnut":color=["red","golden","orange","chestnut"];return color;break;case"red/golden/orange/chestnut - with black":color=["red","golden","orange","chestnut","black"];return color;break;case"red/golden/orange/chestnut - with white":color=["red","golden","orange","chestnut","white"];return color;break;case"silver & tan (yorkie colors)":color=["silver","tan"];return color;break;case"tan/yellow/fawn":color=["tan","yellow","fawn"];return color;break;case"tan/yellow/fawn - with black":color=["tan","yellow","fawn","black"];return color;break;case"tan/yellow/fawn - with white":color=["tan","yellow","fawn","white"];return color;break;case"tricolor (tan/brown & black & white)":color=["tan","brown","black","white"];return color;break;case"white":color=["white"];return color;break;case"white - with black":color=["white","black"];return color;break;case"white - with brown or chocolate":color=["white","brown","chocolate"];return color;break;case"white - with gray or silver":color=["white","gray","silver"];return color;break;case"white - with red, golden, orange or chestnut":color=["white","red","golden","orange","chestnut"];return color;break;case"white - with tan, yellow or fawn":color=["white","tan","yellow","fawn"];return color;break;case"black & white or tuxedo":color=["black","white","tuxedo"];return color;break;case"black (all)":color=["black"];return color;break;case"black (mostly)":color=["black"];return color;break;case"brown tabby":color=["brown"];return color;break;case"brown or chocolate":color=["brown","chocolate"];return color;break;case"brown or chocolate (mostly)":color=["brown","chocolate"];return color;break;case"calico or dilute calico":color=["calico"];return color;break;case"cream or ivory":color=["cream","ivory"];return color;break;case"cream or ivory (mostly)":color=["cream","ivory"];return color;break;case"gray or blue":color=["gray","blue"];return color;break;case"gray or blue (mostly)":color=["gray","blue"];return color;break;case"gray, blue or silver tabby":color=["gray","blue","silver","tabby"];return color;break;case"orange or red":color=["orange","red"];return color;break;case"orange or red (mostly)":color=["orange","red"];return color;break;case"orange or red tabby":color=["orange","red","tabby"];return color;break;case"spotted tabby/leopard spotted":color=["tabby","leopard"];return color;break;case"tan or fawn":color=["tan","fawn"];return color;break;case"tan or fawn (mostly)":color=["tan","fawn"];return color;break;case"tan or fawn tabby":color=["tan","fawn","tabby"];return color;break;case"tiger striped":color=["striped"];return color;break;case"tortoiseshell":color=["tortoiseshell"];return color;break;case"white (mostly)":color=["white"];return color;break;default:color=[];break}};x()})(jQuery)